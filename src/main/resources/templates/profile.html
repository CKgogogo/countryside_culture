<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>个人信息</title>
    <link rel="shortcut icon" href="../assets/image/logo/logo3.png"  />
    <link rel="stylesheet" href="../assets/css/bootstrap.css">
    <link rel="stylesheet" href="https://unpkg.com/animate.css@3.5.2/animate.min.css">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/font-awesome.min.css">
    <style>
        .nav-pills .nav-link.active, .nav-pills .show > .nav-link {
            color: #fff;
            background-color: #999;
        }
        p{
            font-family: SimSun;
        }
    </style>
</head>
<body class="animated fadeIn">
<div class="container-fluid p-0 ">
    <nav class="navbar navbar-expand-sm navbar-dark bg-dark .fixed-top">
        <a href="/index" class="navbar-brand p-0" style="width: 88px;">
            <img src="../assets/image/logo/logo2.png"  width="100%" alt="">
        </a>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav daohang">
                <li class="nav-item">
                    <a href="/index" class="nav-link  active">首页</a>
                </li>
                <li class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">知越
                    </a>
                    <div class="dropdown-menu text-center">
                        <a href="/famousPeople" class="dropdown-item"  >越剧名人</a>
                        <a href="/activity/showall?pn=1" class="dropdown-item ">精彩活动</a>
                        <a href="/yueJuTown" class="dropdown-item">越剧小镇</a>
                        <a href="/costume" class="dropdown-item">戏服</a>
                        <a href="/prop" class="dropdown-item">表演道具</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="/news/showall?pn=1" class="nav-link">资讯</a>
                </li>
                <li class="nav-item">
                    <a href="/culture" class="nav-link">嵊州风情</a>
                </li>

                <li class="nav-item">
                    <a href="/video" class="nav-link">在线视频</a>
                </li>
                <li class="nav-item">
                    <a href="/live" class="nav-link">直播</a>
                </li>
            </ul>
            <a  th:if="${session.user_id}== null" href="/login" class="fa fa-user-circle nav-link ml-auto" style="font-size: 24px;color:white"></a>
            <a th:if="${session.user_id}!= null" href="/user/show" class=" nav-link ml-auto" style="font-size: 24px;color:white;width: 75px;">
                <img th:src="@{'../assets/image/user/'+${session.picture}}" width="100%" class="rounded-circle" alt=""></a>
        </div>
    </nav>
</div>

<div class="container mt-5">
    <div class="row">
        <div class="col-3 offset-1 p-0" style="background-color: #dae0e5 ; height: 530px;"   >
            <div class="col-12 p-0 " style="background:url(../assets/image/bg.jpg) no-repeat;height:273px; ">
                <div class="col-5  m-auto">
                    <img th:src="@{'../assets/image/user/'+${session.picture}}" class="img-fluid rounded-circle mt-5" alt="">
                    <p class="mt-4 font-weight-bold" style="text-align: center" th:text="${session.nickname}"></p>
                </div>
            </div>
            <div class="nav nav-pills flex-column text-left mt-3" style="height: 250px;">
                <a href="#" class="nav-link active " data-toggle="tab" data-target="#tab1" style="color: #343a40;">浏览记录</a>
                <a href="#" class="nav-link" data-toggle="tab" data-target="#tab2" style="color: #343a40;">我的收藏</a>
                <a href="#" class="nav-link " data-toggle="tab" data-target="#tab3" style="color: #343a40;">我的关注</a>
                <a href="#" class="nav-link " data-toggle="tab" data-target="#tab4" style="color: #343a40;">个人资料</a>
                <a href="#" class="nav-link " data-toggle="tab" data-target="#tab5" style="color: #343a40;">修改密码</a>
                <a href="#" onclick="logout()" class="nav-link " data-toggle="tab"  style="color: #343a40;">退出登录</a>
            </div>
        </div>
        <div class="col-7">
            <div class="tab-content">
                <div class="tab-pane fade show active" id="tab1">
                    <div class="col-12 row ml-1">
                        <div class="col-12">
                            <p style="font-size: 23px;font-weight: 900;">今天</p>
                        </div>
                        <div class="col-4 pl-0" th:each="v1:${today}">
                            <a th:href="'/video/selectone?id='+${v1.id}">
                                <div class="box">
                                    <img style="" class="img-fluid rounded"
                                         th:src="@{'../assets/image/video/'+${v1.picture}}">
                                    <div class="box-content">
                                        <span class="title fa fa-play-circle-o"
                                              style="color: white;font-size: 55px;"></span>
                                    </div>
                                </div>
                            </a>
                            <a th:href="'/video/selectone?id='+${v1.id}" class="text-muted nav-link">
                                <p class="text-break text-left videoTitle" style="" th:text="${v1.title}"></p>
                            </a>
                        </div>
                    </div>

                    <div class="col-12 row ml-1">
                        <div class="col-12">
                            <p style="font-size: 23px;font-weight: 900;">昨天</p>
                        </div>
                        <div class="col-4 pl-0" th:each="v2:${tomorrow}">
                            <a th:href="'/video/selectone?id='+${v2.id}">
                                <div class="box">
                                    <img style="" class="img-fluid rounded"
                                         th:src="@{'../assets/image/video/'+${v2.picture}}">
                                    <div class="box-content">
                                        <span class="title fa fa-play-circle-o"
                                              style="color: white;font-size: 55px;"></span>
                                    </div>
                                </div>
                            </a>
                            <a th:href="'/video/selectone?id='+${v2.id}" class="text-muted nav-link">
                                <p class="text-break text-left videoTitle" style="" th:text="${v2.title}"></p>
                            </a>
                        </div>
                    </div>

                    <div class="col-12 row ml-1">
                        <div class="col-12">
                            <p style="font-size: 23px;font-weight: 900;">更早</p>
                        </div>
                        <div class="col-4 pl-0" th:each="v3:${earlier}">
                            <a th:href="'/video/selectone?id='+${v3.id}">
                                <div class="box">
                                    <img style="" class="img-fluid rounded"
                                         th:src="@{'../assets/image/video/'+${v3.picture}}">
                                    <div class="box-content">
                                        <span class="title fa fa-play-circle-o"
                                              style="color: white;font-size: 55px;"></span>
                                    </div>
                                </div>
                            </a>
                            <a th:href="'/video/selectone?id='+${v3.id}" class="text-muted nav-link">
                                <p class="text-break text-left videoTitle" style="" th:text="${v3.title}"></p>
                            </a>
                        </div>
                    </div>
                </div>


                <div class="tab-pane fade" id="tab2">
                    <div class="col-12 text-center">
                        <h4>我的收藏</h4>
                    </div>
                    <br>
                    <div class="col-12 row ml-1"  >
                        <div class="col-4 pl-0" th:each="a2:${collect}">
                            <a th:href="'/video/selectone?id='+${a2.vid}">
                                <div class="box">
                                    <img style="" class="img-fluid rounded"
                                         th:src="@{'../assets/image/video/'+${a2.picture}}">
                                    <div class="box-content">
                                        <span class="title fa fa-play-circle-o"
                                              style="color: white;font-size: 55px;"></span>
                                    </div>
                                </div>
                            </a>
                            <a th:href="'/video/selectone?id='+${a2.vid}" class="text-muted nav-link">
                                <p class="text-break text-center videoTitle"  th:text="${a2.title}"></p>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="tab3">
                    <div class="col-12 text-center">
                        <h4>我的关注</h4>
                    </div>
                    <br>
                    <div class="col-12 row" >
                        <div class="col-4" th:each="a3:${focus}">
                            <a th:href="'/video/actorplay?id='+${a3.mid}">
                            <img th:src="@{'../assets/image/people/'+${a3.picture}}" class="img-fluid rounded-circle" alt="">
                            </a>
                            <p class="mt-4 font-weight-bold" style="text-align: center" th:text="${a3.name}"></p>

                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="tab4">
                    <div class="col-12 text-center">
                        <h5>个人资料</h5>
                    </div>
                    <div class="col-12">
                        <div class="col-7 offset-2">
                            <form action="" class="mt-5">
                                <div class="form-group row">
                                    <label for="nickname" class="col-3 col-form-label">昵称</label>
                                    <div class="col-9">
                                        <input type="text" class="form-control" id="nickname"
                                               th:placeholder="${session.nickname}">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="phone" class="col-3 col-form-label">手机</label>
                                    <div class="col-9">
                                        <input type="text" class="form-control" id="phone"
                                               th:placeholder="${session.user.phone}">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="email" class="col-3 col-form-label">邮箱</label>
                                    <div class="col-9">
                                        <input type="text" class="form-control" id="email"
                                               th:placeholder="${session.user.email}">
                                    </div>
                                </div>
                                <div class="col-12 text-center">
                                    <button type="button" onclick="check1()" class="btn btn-light">修改</button>
                                </div>
                            </form>

                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="tab5">
                    <div class="col-12 text-center">
                        <h5>修改密码</h5>
                    </div>
                    <div class="col-7 offset-2">
                        <form class="mt-5" action=""  method="post">
                            <div class="form-group row">
                                <label for="oldpassword" class="col-3 col-form-label">原密码</label>
                                <div class="col-9">
                                    <input type="password" class="form-control" id="oldpassword" name="oldpassword">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="newpassword" class="col-3 col-form-label">新密码</label>
                                <div class="col-9">
                                    <input type="password" class="form-control" id="newpassword" name="newpassword">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="newpassword2" class="col-3 col-form-label">确认密码</label>
                                <div class="col-9">
                                    <input type="password" class="form-control" id="newpassword2" name="newpassword2">
                                </div>
                            </div>
                            <div class="col-12 text-center">
                                <button type="button" onclick="check2()" class="btn btn-light">确认修改</button>
                            </div>
                        </form>

                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/js/jquery-2.2.4.js"></script>
<script src="../assets/js/bootstrap.bundle.js"></script>
<script th:inline="javascript" >
    function check1() {
        var myreg=/^[1][3,4,5,6,7,8,9][0-9]{9}$/;
        var re=/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/;
        var a=false;
        var nickname=$('#nickname').val();
        var phone=$('#phone').val();
        var email=$('#email').val();
        if (nickname=='') {
            alert("昵称不能为空");
        }else if (phone!=''){
            if (!myreg.test(phone)) {
                alert("请输入正确的手机号")
            }else {
                a=true;
            }
        }else if(email=='') {
                alert("邮箱不能为空");
        }else if (email!='') {
            if (!re.test(email)) {
                alert("请输入正确的邮箱")
            }else {
                a=true;
            }
        }else {
            a=true;
        }
        if (a) {
            $.ajax({
                url: "/user/update",
                data: {
                    nickname: nickname,
                    phone: phone,
                    email: email
                },
                type: 'post',
                success: function (str) {
                    if (str == 'ok') {
                        alert("修改成功！")
                        window.location.reload();
                    } else if (str == 'no') {
                        alert("昵称已经存在")
                    }
                },
                error: function (err) {
                    // alert(err);
                }
            });
        }
    }

    function check2() {
        var oldpassword=$('#oldpassword').val();
        var newpassword=$('#newpassword').val();
        var newpassword2=$('#newpassword2').val();
        if (oldpassword==''||newpassword==''||newpassword2=='') {
            alert("不能为空");
        }else if(newpassword!=newpassword2){
            alert("密码不一致");
        }else {
            $.ajax({
                url: "/user/modifypwd",
                data: {
                    oldpassword: oldpassword,
                    newpassword: newpassword
                },
                type: 'post',
                success: function (str) {
                    if (str == 'ok') {
                        alert("修改成功，请重新登录！")
                        window.location.href = "/login";
                    } else if (str == 'no') {
                        alert("原密码错误！")
                    }
                },
                error: function (err) {
                    // alert(err);
                }
            });
        }
    }



    function logout() {
        var a = window.confirm("您确定要退出登录吗?");
        if(a==true){
            $.ajax({
                url:"/user/logout",
                data:{},
                type:'post',
                success:function (str) {
                    if (str=='ok'){
                        alert("退出成功！")
                        window.location.href="/index";
                    }
                },
                error:function (err) {
                    // alert(err);
                }
            });
        }
    }
    
</script>
</body>
</html>